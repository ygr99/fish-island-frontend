<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <title>çœ‹å›¾çŒœæˆè¯­</title>
    <style>
      body {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        margin: 0;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        font-family: "Microsoft YaHei", "å¾®è½¯é›…é»‘", Arial, sans-serif;
      }

      .game-container {
        background: #ffffff;
        padding: 2rem;
        border-radius: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        text-align: center;
        width: 90%;
        max-width: 500px;
      }

      .idiom-image {
        width: 100%;
        height: 200px;
        object-fit: contain;
        margin: 1rem 0;
        border: 1px solid #e0e0e0;
        border-radius: 10px;
      }

      .input-area {
        display: flex;
        margin: 1rem 0;
      }

      #idiomInput {
        flex: 1;
        padding: 0.8rem 1rem;
        font-size: 1.2rem;
        border: 2px solid #e0e0e0;
        border-radius: 10px 0 0 10px;
        outline: none;
      }

      #checkBtn {
        padding: 0.8rem 1.5rem;
        background: #3498db;
        color: white;
        border: none;
        border-radius: 0 10px 10px 0;
        cursor: pointer;
        transition: all 0.2s;
        font-size: 1.2rem;
      }

      #checkBtn:hover {
        background: #2980b9;
      }

      #result {
        min-height: 50px;
        font-size: 1.2rem;
        color: #2c3e50;
        margin: 1rem 0;
        font-weight: bold;
      }

      #nextBtn {
        font-size: 1.2rem;
        padding: 0.8rem 2rem;
        background: #2ecc71;
        color: white;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.2s;
        margin-top: 1rem;
      }

      #nextBtn:hover {
        background: #27ae60;
      }

      .controls {
        display: flex;
        justify-content: space-between;
        margin-top: 1rem;
      }

      #showAnswerBtn {
        font-size: 1rem;
        padding: 0.5rem 1rem;
        background: #e74c3c;
        color: white;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.2s;
      }

      #showAnswerBtn:hover {
        background: #c0392b;
      }

      #scoreDisplay {
        font-size: 1.2rem;
        color: #2c3e50;
        margin-bottom: 1rem;
      }

      .loading {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 200px;
      }

      .loading-spinner {
        border: 5px solid #f3f3f3;
        border-top: 5px solid #3498db;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body>
    <div class="game-container">
      <h1>çœ‹å›¾çŒœæˆè¯­</h1>
      <div id="scoreDisplay">åˆ†æ•°: 0</div>

      <div id="loadingContainer" class="loading">
        <div class="loading-spinner"></div>
      </div>

      <img
        id="idiomImage"
        class="idiom-image"
        style="display: none"
        alt="æˆè¯­å›¾ç‰‡"
      />

      <div class="input-area">
        <input type="text" id="idiomInput" placeholder="è¯·è¾“å…¥æˆè¯­..." />
        <button id="checkBtn">ç¡®è®¤</button>
      </div>

      <div id="result"></div>

      <div class="controls">
        <button id="showAnswerBtn">æŸ¥çœ‹ç­”æ¡ˆ</button>
        <button id="nextBtn">ä¸‹ä¸€é¢˜</button>
      </div>
    </div>

    <script>
      // æ¸¸æˆçŠ¶æ€
      let currentAnswer = "";
      let score = 0;
      let isAnswerShown = false;

      // DOM å…ƒç´ 
      const idiomImage = document.getElementById("idiomImage");
      const idiomInput = document.getElementById("idiomInput");
      const checkBtn = document.getElementById("checkBtn");
      const showAnswerBtn = document.getElementById("showAnswerBtn");
      const nextBtn = document.getElementById("nextBtn");
      const result = document.getElementById("result");
      const scoreDisplay = document.getElementById("scoreDisplay");
      const loadingContainer = document.getElementById("loadingContainer");

      // åŠ è½½æ–°é¢˜ç›®
      async function loadNewQuestion() {
        try {
          // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
          loadingContainer.style.display = "flex";
          idiomImage.style.display = "none";
          result.textContent = "";
          idiomInput.value = "";
          isAnswerShown = false;

          // è¯·æ±‚æ–°é¢˜ç›®
          const response = await fetch(
            "https://xiaoapi.cn/API/game_ktccy.php?msg=å¼€å§‹æ¸¸æˆ&id=99"
          );
          const data = await response.json();

          if (data.code === 200) {
            // åŠ è½½æˆåŠŸ
            currentAnswer = data.data.answer;
            idiomImage.src = data.data.pic;
            idiomImage.onload = () => {
              // å›¾ç‰‡åŠ è½½å®Œæˆåï¼Œæ˜¾ç¤ºå›¾ç‰‡å¹¶éšè—åŠ è½½åŠ¨ç”»
              loadingContainer.style.display = "none";
              idiomImage.style.display = "block";
            };
          } else {
            throw new Error("è·å–é¢˜ç›®å¤±è´¥");
          }
        } catch (error) {
          console.error("è·å–é¢˜ç›®å‡ºé”™:", error);
          result.textContent = "åŠ è½½é¢˜ç›®å¤±è´¥ï¼Œè¯·ç‚¹å‡»ä¸‹ä¸€é¢˜é‡è¯•";
          result.style.color = "#e74c3c";
          loadingContainer.style.display = "none";
        }
      }

      // æ£€æŸ¥ç­”æ¡ˆ
      function checkAnswer() {
        if (isAnswerShown) {
          result.textContent = "å·²æŸ¥çœ‹ç­”æ¡ˆï¼Œä¸èƒ½æäº¤ï¼Œè¯·ç‚¹å‡»ä¸‹ä¸€é¢˜";
          result.style.color = "#e74c3c";

          // 3ç§’åè‡ªåŠ¨æ¸…é™¤æç¤º
          setTimeout(() => {
            result.textContent = "";
          }, 3000);
          return;
        }

        const userAnswer = idiomInput.value.trim();
        if (!userAnswer) {
          result.textContent = "è¯·è¾“å…¥ç­”æ¡ˆ";
          result.style.color = "#e74c3c";
          return;
        }

        if (userAnswer === currentAnswer) {
          score += 10;
          scoreDisplay.textContent = `åˆ†æ•°: ${score}`;
          result.textContent = "ğŸ‰ å›ç­”æ­£ç¡®ï¼";
          result.style.color = "#27ae60";
        } else {
          result.textContent = "âŒ å›ç­”é”™è¯¯ï¼Œè¯·é‡è¯•æˆ–æŸ¥çœ‹ç­”æ¡ˆ";
          result.style.color = "#e74c3c";

          // 3ç§’åè‡ªåŠ¨æ¸…é™¤é”™è¯¯æç¤º
          setTimeout(() => {
            result.textContent = "";
          }, 3000);
        }
      }

      // æ˜¾ç¤ºç­”æ¡ˆ
      function showAnswer() {
        if (!currentAnswer) return;

        isAnswerShown = true;
        result.textContent = `æ­£ç¡®ç­”æ¡ˆæ˜¯: ${currentAnswer}`;
        result.style.color = "#3498db";
      }

      // äº‹ä»¶ç›‘å¬
      checkBtn.addEventListener("click", checkAnswer);
      showAnswerBtn.addEventListener("click", showAnswer);
      nextBtn.addEventListener("click", loadNewQuestion);

      // æ”¯æŒæŒ‰å›è½¦é”®æäº¤ç­”æ¡ˆ
      idiomInput.addEventListener("keypress", function (event) {
        if (event.key === "Enter") {
          checkAnswer();
        }
      });

      // é¡µé¢åŠ è½½æ—¶è·å–ç¬¬ä¸€é“é¢˜
      window.addEventListener("load", loadNewQuestion);
    </script>
  </body>
</html>
